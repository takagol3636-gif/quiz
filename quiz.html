<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>ã‚­ãƒ£ãƒ‡ã‚£ãƒ¼ç ”ä¿®ç”¨ã‚¯ã‚¤ã‚º</title>

  <style>
    body{
      margin:0;
      font-family: system-ui, -apple-system, "Segoe UI", Roboto, "Hiragino Kaku Gothic ProN", "Noto Sans JP", "Yu Gothic", sans-serif;
      background:#0b3d0b;
      color:white;
      text-align:center;
    }
    .container{
      max-width:700px;
      margin:auto;
      padding:20px;
    }
    .card{
      background:rgba(0,0,0,0.85);
      padding:20px;
      border-radius:12px;
      text-align:left;
    }
    h1,h2{ text-align:center; margin: 0 0 12px 0; }
    p{ line-height:1.6; }

    button{
      width:100%;
      padding:15px;
      margin:8px 0;
      font-size:16px;
      border:none;
      border-radius:10px;
      background:#1b5e20;
      color:white;
      -webkit-tap-highlight-color: transparent;
      cursor:pointer;
    }
    button:disabled{opacity:0.6; cursor:not-allowed;}
    .btnSecondary{ background:#2c2c2c; }
    .btnGhost{ background:transparent; border:1px solid rgba(255,255,255,0.25); }

    .correct{background:#1f7a1f !important;}
    .wrong{background:#8b1a1a !important;}
    .revealCorrect{ outline:2px solid rgba(255,255,255,0.45); }

    #adminPanel{display:none;}

    input{
      width:90%;
      padding:12px;
      font-size:18px;
      box-sizing:border-box;
      border-radius:10px;
      border:none;
      outline:none;
    }

    .pill{
      display:inline-block;
      padding:6px 10px;
      border-radius:999px;
      background:rgba(255,255,255,0.12);
      font-size:13px;
      margin:0 6px 10px 0;
    }
    .center{ text-align:center; }

    .explainBox{
      margin-top:12px;
      padding:14px;
      border-radius:12px;
      background:rgba(255,255,255,0.08);
    }
    .explainTitle{ font-weight:700; margin-bottom:8px; }
    .muted{ opacity:0.85; font-size:14px; text-align:center; }
  </style>
</head>

<body>
  <div class="container">
    <div class="card" id="gameArea"></div>
    <p class="muted">ä¸æ­£è§£æ™‚ï¼šæ­£è§£å¼·èª¿ï¼‹è§£èª¬ â†’ æ¬¡ã¸ï½œçµ‚äº†å¾Œï¼šãƒ¬ãƒ™ãƒ«é¸æŠã¸æˆ»ã‚‹</p>
  </div>

  <script>
  "use strict";

  // =====================
  // â˜… Googleä¿å­˜URLã‚’å…¥ã‚Œã‚‹ï¼ˆå¿…è¦ãªã‚‰ï¼‰
  // =====================
  const GOOGLE_SCRIPT_URL = "ã“ã“ã«GASã®URLã‚’è²¼ã‚‹";

  // =====================
  // localStorage keys
  // =====================
  const LS_NAME = "caddieQuiz_name";

  // =====================
  // å¤‰æ•°
  // =====================
  let currentLevel = "";
  let currentQuestion = 0;
  let score = 0;
  let quizData = [];
  let playerName = "";

  // é¸æŠè‚¢ï¼ˆã‚·ãƒ£ãƒƒãƒ•ãƒ«å¾Œã®æ­£èª¤åˆ¤å®šç”¨ï¼‰
  window.currentOptions = [];

  // é€²æ—ã¨ãƒ­ã‚°ï¼ˆç«¯æœ«å†…ã«ä¿å­˜ï¼‰
  let progress = JSON.parse(localStorage.getItem("caddieProgress")) || {
    beginner:false,
    intermediate:false,
    advanced:false,
    master:false
  };

  let logs = JSON.parse(localStorage.getItem("caddieLogs")) || [];

  // =====================
  function shuffleArray(array){
    for(let i=array.length-1;i>0;i--){
      let j=Math.floor(Math.random()*(i+1));
      [array[i],array[j]]=[array[j],array[i]];
    }
    return array;
  }

  // =====================
  // â˜… ãƒ©ãƒ³ã‚¯åˆ¤å®š
  // =====================
  function getRank(rate){
    if(rate===100)return "ğŸ‘‘ SSS";
    if(rate>=90)return "ğŸ† S";
    if(rate>=80)return "ğŸ¥‡ A";
    if(rate>=70)return "ğŸ¥ˆ B";
    if(rate>=60)return "ğŸ¥‰ C";
    return "ğŸ”° D";
  }

  function levelLabel(level){
    if(level==="beginner") return "åˆç´š";
    if(level==="intermediate") return "ä¸­ç´š";
    if(level==="advanced") return "ä¸Šç´š";
    if(level==="master") return "ğŸ”¥ è¶…ä¸Šç´š";
    return level;
  }

  // =====================
  // å•é¡Œãƒ‡ãƒ¼ã‚¿ï¼ˆã‚ãªãŸã®å…ƒãƒ‡ãƒ¼ã‚¿ï¼šexplanationå…¥ã‚Šãªã®ã§OKï¼‰
  // =====================
  const beginner = [
    {question:"ã‚­ãƒ£ãƒ‡ã‚£ãƒ¼ã®åŸºæœ¬å§¿å‹¢ã¨ã—ã¦æœ€ã‚‚é‡è¦ãªã®ã¯ï¼Ÿ",
    choices:["ã‚¹ãƒ”ãƒ¼ãƒ‰","ç¬‘é¡”ã¨ç¤¼å„€","è·é›¢æ„Ÿè¦š","å£°é‡"],
    answer:1, explanation:"ç¬¬ä¸€å°è±¡ã¯ç¬‘é¡”ã¨ç¤¼å„€ã§æ±ºã¾ã‚‹ã€‚"},

    {question:"ãƒ†ã‚£ãƒ¼ã‚°ãƒ©ã‚¦ãƒ³ãƒ‰ã§æœ€åˆã«ç¢ºèªã™ã‚‹ã®ã¯ï¼Ÿ",
    choices:["é¢¨å‘ã","ãƒ”ãƒ³ä½ç½®","ä½¿ç”¨ãƒ†ã‚£ãƒ¼","å‰çµ„ã®ä½ç½®"],
    answer:3, explanation:"å®‰å…¨ç¢ºèªãŒæœ€å„ªå…ˆã€‚"},

    {question:"æ®‹ã‚Šè·é›¢ã‚’ä¼ãˆã‚‹æ™‚ã«å¿…è¦ãªã®ã¯ï¼Ÿ",
    choices:["è‡ªä¿¡","å‹˜","æ­£ç¢ºãªè¨ˆæ¸¬","çµŒé¨“å‰‡ã®ã¿"],
    answer:2, explanation:"æ­£ç¢ºãªè·é›¢ãŒåŸºæœ¬ã€‚"},

    {question:"ãƒãƒ³ã‚«ãƒ¼å‡ã—ã§æ­£ã—ã„ã®ã¯ï¼Ÿ",
    choices:["è¶³è·¡ã ã‘","å…¨ä½“å‡ã™","æ”¾ç½®","ãƒ¬ãƒ¼ã‚­ç«‹ã¦ã‚‹"],
    answer:1, explanation:"å…¨ä½“ã‚’ä¸å¯§ã«å‡ã™ã€‚"},

    {question:"OBã®æ­£å¼åç§°ã¯ï¼Ÿ",
    choices:["Out Ball","Official Boundary","Out of Bounds","Outside Birdie"],
    answer:2, explanation:"Out of Boundsã®ç•¥ã€‚"},

    {question:"ã‚°ãƒªãƒ¼ãƒ³ä¸Šã§èµ°ã£ã¦è‰¯ã„ï¼Ÿ",
    choices:["OK","çŠ¶æ³æ¬¡ç¬¬","åŸºæœ¬NG","æ€¥ã’ã°å¯"],
    answer:2, explanation:"èŠä¿è­·ã®ãŸã‚èµ°ã‚‰ãªã„ã€‚"},

    {question:"ãŠå®¢æ§˜ã®ã‚¯ãƒ©ãƒ–ç¢ºèªã¯ã„ã¤ï¼Ÿ",
    choices:["å‰æ—¥","å¸¸æ™‚","ã‚·ãƒ§ãƒƒãƒˆå‰","çµ‚ã‚ã£ã¦ã‹ã‚‰"],
    answer:2, explanation:"æ¸¡ã™å‰ã«å¿…ãšç¢ºèªã€‚"},

    {question:"ãƒ—ãƒ¬ãƒ¼ãƒ•ã‚¡ã‚¹ãƒˆã®åŸºæœ¬ã¯ï¼Ÿ",
    choices:["æ€¥ãŒã›ã‚‹","æº–å‚™ã®å¾¹åº•","ç„¡è¨€","èµ°ã‚‹"],
    answer:1, explanation:"æº–å‚™ã‚’æ•´ãˆã‚‹ã“ã¨ãŒé‡è¦ã€‚"},

    {question:"ãƒœãƒ¼ãƒ«ãƒãƒ¼ã‚¯ä¿®å¾©ã¯èª°ã®ä»•äº‹ï¼Ÿ",
    choices:["ã‚­ãƒ£ãƒ‡ã‚£ãƒ¼","ãŠå®¢æ§˜","è¦‹ã¤ã‘ãŸäºº","å…¨å“¡"],
    answer:3, explanation:"è¦‹ã¤ã‘ãŸäººãŒç›´ã™ã®ãŒãƒãƒŠãƒ¼ã€‚"},

    {question:"é›¨å¤©æ™‚å„ªå…ˆã™ã¹ãã¯ï¼Ÿ",
    choices:["é€Ÿåº¦","å®‰å…¨","å£²ä¸Š","æ¼”å‡º"],
    answer:1, explanation:"å®‰å…¨æœ€å„ªå…ˆã€‚"}
  ];

  const intermediate = [
    {question:"å‘ã‹ã„é¢¨5mã€150yã®ç›®å®‰ã¯ï¼Ÿ",
    choices:["ãã®ã¾ã¾","1ç•ªæ‰‹ä¸Šã’","2ç•ªæ‰‹ä¸Šã’","ä¸‹ã’ã‚‹"],
    answer:1, explanation:"åŸºæœ¬ã¯1ç•ªæ‰‹ä¸Šã’ã€‚"},

    {question:"ãƒ•ã‚©ãƒ­ãƒ¼é¢¨ã®æ³¨æ„ç‚¹ã¯ï¼Ÿ",
    choices:["é£›ã°ãªã„","æ­¢ã¾ã‚Šã«ãã„","æ›²ãŒã‚‹","çŸ­ããªã‚‹"],
    answer:1, explanation:"ãƒ©ãƒ³ãŒå‡ºã‚‹ã€‚"},

    {question:"ç¡¬ã„ã‚°ãƒªãƒ¼ãƒ³ã®ç‹™ã„ã¯ï¼Ÿ",
    choices:["å¥¥","ãƒ”ãƒ³","æ‰‹å‰","ç„¡è¦–"],
    answer:2, explanation:"æ‰‹å‰ã‹ã‚‰æ”»ã‚ã‚‹ã€‚"},

    {question:"èª¤çƒé˜²æ­¢ã§é‡è¦ãªã®ã¯ï¼Ÿ",
    choices:["è‰²ç¢ºèª","ç•ªå·ç¢ºèª","ãƒ¡ãƒ¼ã‚«ãƒ¼ç¢ºèª","å…¨éƒ¨"],
    answer:3, explanation:"å…¨ç¢ºèªãŒåŸºæœ¬ã€‚"},

    {question:"é›·é³´ãŒèã“ãˆãŸã‚‰ï¼Ÿ",
    choices:["ç¶šè¡Œ","æ§˜å­è¦‹","é¿é›£ææ¡ˆ","æ€¥ã"],
    answer:2, explanation:"å³å®‰å…¨ç¢ºä¿ã€‚"},

    {question:"æ·±ã„ãƒ©ãƒ•ã®ç•ªæ‰‹é¸æŠã¯ï¼Ÿ",
    choices:["ä¸Šã’ã‚‹","ä¸‹ã’ã‚‹","å¤‰ãˆãªã„","å¼·æŒ¯"],
    answer:1, explanation:"è„±å‡ºå„ªå…ˆã§ä¸‹ã’ã‚‹åˆ¤æ–­ã‚‚é‡è¦ã€‚"},

    {question:"ä¸‹ã‚Šãƒ‘ãƒƒãƒˆã§é‡è¦ãªã®ã¯ï¼Ÿ",
    choices:["å¼·ã","å¼±ã","çœŸã£ç›´ã","ç„¡è¦–"],
    answer:1, explanation:"ã‚¿ãƒƒãƒé‡è¦–ã€‚"},

    {question:"ç«¶æŠ€ã§è·é›¢è¨ˆã¯ï¼Ÿ",
    choices:["è‡ªç”±","ç¦æ­¢","æ¡ä»¶ä»˜ãå¯","ç„¡é–¢ä¿‚"],
    answer:2, explanation:"ãƒ­ãƒ¼ã‚«ãƒ«ãƒ«ãƒ¼ãƒ«ç¢ºèªå¿…é ˆã€‚"},

    {question:"æš«å®šçƒå®£è¨€ãŒç„¡ã„å ´åˆï¼Ÿ",
    choices:["æœ‰åŠ¹","ç„¡åŠ¹","å¾Œã§OK","ç„¡è¦–"],
    answer:1, explanation:"å®£è¨€ãªã—ã¯æš«å®šçƒã«ãªã‚‰ãªã„ã€‚"},

    {question:"çƒæ¢ã—åˆ¶é™æ™‚é–“ã¯ï¼Ÿ",
    choices:["3åˆ†","5åˆ†","2åˆ†","ç„¡åˆ¶é™"],
    answer:0, explanation:"3åˆ†ãƒ«ãƒ¼ãƒ«ã€‚"},

    {question:"ã‚¢ãƒ³ãƒ—ãƒ¬å®£è¨€ã¯èª°ï¼Ÿ",
    choices:["ã‚­ãƒ£ãƒ‡ã‚£ãƒ¼","åŒä¼´è€…","æœ¬äºº","ç«¶æŠ€å§”å“¡"],
    answer:2, explanation:"ãƒ—ãƒ¬ãƒ¼ãƒ¤ãƒ¼æœ¬äººã®ã¿ã€‚"},

    {question:"æ‰“é †ã®åŸºæœ¬ã¯ï¼Ÿ",
    choices:["è‹¥ã„é †","é ã„é †","é€Ÿã„é †","ç”³å‘Šé †"],
    answer:1, explanation:"ãƒ›ãƒ¼ãƒ«ã‹ã‚‰é ã„é †ã€‚"},

    {question:"ãƒ”ãƒ³ã‚’æŠœãåˆ¤æ–­ã¯ï¼Ÿ",
    choices:["å¿…ãšæŠœã","å¿…ãšç«‹ã¦ã‚‹","çŠ¶æ³æ¬¡ç¬¬","ç„¡è¦–"],
    answer:2, explanation:"ç¾åœ¨ã¯ç«‹ã¦ãŸã¾ã¾å¯ã€‚"},

    {question:"å‚¾æ–œåœ°ã§ã®åŠ©è¨€ã¯ï¼Ÿ",
    choices:["å¼·ã","é€šå¸¸é€šã‚Š","1ç•ªæ‰‹ä¸Šã’","çŠ¶æ³èª¬æ˜"],
    answer:3, explanation:"å‚¾æ–œèª¬æ˜ãŒé‡è¦ã€‚"},

    {question:"æ—ã®ä¸­ã§å„ªå…ˆã¯ï¼Ÿ",
    choices:["è·é›¢","æ–¹å‘","è„±å‡º","ãƒ”ãƒ³"],
    answer:2, explanation:"è„±å‡ºå„ªå…ˆã€‚"},

    {question:"æœéœ²ã‚°ãƒªãƒ¼ãƒ³ã¯ï¼Ÿ",
    choices:["é€Ÿã„","é…ã„","æ™®é€š","èª­ã‚ãªã„"],
    answer:1, explanation:"é‡ããªã‚‹å‚¾å‘ã€‚"},

    {question:"ç«¶æŠ€ä¸­ã‚¢ãƒ‰ãƒã‚¤ã‚¹ç¯„å›²ã¯ï¼Ÿ",
    choices:["å…¨é¢OK","ç¦æ­¢","è¦å‰‡å†…","è‡ªç”±"],
    answer:2, explanation:"è¦å‰‡å†…ã®ã¿å¯ã€‚"},

    {question:"æ‰“çƒãŒä»–äººã«å½“ãŸã£ãŸã‚‰ï¼Ÿ",
    choices:["ç„¡åŠ¹","ç½°","åŸå‰‡ãã®ã¾ã¾","æ‰“ã¡ç›´ã—"],
    answer:2, explanation:"åŸå‰‡ãã®ã¾ã¾ã€‚"},

    {question:"æ± è¶Šãˆå¿ƒç†ã¯ï¼Ÿ",
    choices:["å¼·ããªã‚‹","å¼±ããªã‚‹","å¤‰ã‚ã‚‰ãªã„","ç„¡é–¢ä¿‚"],
    answer:1, explanation:"ã‚·ãƒ§ãƒ¼ãƒˆã—ã‚„ã™ã„ã€‚"},

    {question:"ãƒ—ãƒ¬ãƒ¼ãƒ•ã‚¡ã‚¹ãƒˆæœ€å¤§è¦å› ã¯ï¼Ÿ",
    choices:["èµ°ã‚‹","æº–å‚™","å£°å‡ºã—","æ€¥ãŒã›ã‚‹"],
    answer:1, explanation:"äº‹å‰æº–å‚™ã€‚"}
  ];

  const advanced = [
    {question:"ç«¶æŠ€ä¸­ã€ãƒ—ãƒ¬ãƒ¼ãƒ¤ãƒ¼ãŒèª¤ã£ãŸè·é›¢ã‚’ä¿¡ã˜ã‹ã‘ã¦ã„ã‚‹ã€‚ã©ã†å¯¾å¿œã™ã‚‹ï¼Ÿ",
    choices:["é»™ã‚‹","å³åº§ã«è¨‚æ­£","ã‚ã¨ã§ä¼ãˆã‚‹","åŒèª¿ã™ã‚‹"],
    answer:1, explanation:"èª¤æƒ…å ±ã¯å³è¨‚æ­£ãŒåŸºæœ¬ã€‚"},

    {question:"æ®‹ã‚Š150yã€å¼·ã„ãƒ•ã‚©ãƒ­ãƒ¼é¢¨ã€‚é©åˆ‡ãªææ¡ˆã¯ï¼Ÿ",
    choices:["1ç•ªæ‰‹ä¸Šã’ã‚‹","1ç•ªæ‰‹ä¸‹ã’ã‚‹","å¤‰ãˆãªã„","å¼·æŒ¯ææ¡ˆ"],
    answer:1, explanation:"ãƒ•ã‚©ãƒ­ãƒ¼ã¯ç•ªæ‰‹ã‚’ä¸‹ã’ã‚‹åˆ¤æ–­ã€‚"},

    {question:"ä¸‹ã‚Š5mã®ã‚¹ãƒ©ã‚¤ã‚¹ãƒ©ã‚¤ãƒ³ã€‚æœ€é‡è¦è¦ç´ ã¯ï¼Ÿ",
    choices:["å¼·ã•","æ›²ãŒã‚Šå¹…","è·é›¢æ„Ÿ","çœŸã£ç›´ãæ‰“ãŸã›ã‚‹"],
    answer:2, explanation:"ä¸‹ã‚Šã¯è·é›¢æ„ŸãŒæœ€å„ªå…ˆã€‚"},

    {question:"ãƒ—ãƒ¬ãƒ¼ãƒ¤ãƒ¼ãŒè‹›ç«‹ã£ã¦ã„ã‚‹æ™‚ã®å¯¾å¿œã¯ï¼Ÿ",
    choices:["ç†è«–èª¬æ˜","å…±æ„Ÿã—è½ã¡ç€ã‹ã›ã‚‹","ç„¡è¦–","å±ã‚‹"],
    answer:1, explanation:"å¿ƒç†ã‚µãƒãƒ¼ãƒˆã‚‚å½¹å‰²ã€‚"},

    {question:"å‰çµ„ã¨2ãƒ›ãƒ¼ãƒ«ç©ºã„ãŸã€‚ã¾ãšä½•ã‚’ã™ã‚‹ï¼Ÿ",
    choices:["æ€¥ãŒã›ã‚‹","çŠ¶æ³å…±æœ‰ã¨æº–å‚™ä¿ƒé€²","ãƒã‚¹ã‚¿ãƒ¼å®¤ç„¡è¦–","é›‘è«‡"],
    answer:1, explanation:"å†·é™ã«çŠ¶æ³å…±æœ‰ã€‚"},

    {question:"æ·±ã„ãƒ©ãƒ•ã‹ã‚‰ãƒ”ãƒ³ç‹™ã„ã€‚æœ€é©åŠ©è¨€ã¯ï¼Ÿ",
    choices:["ç‹™ã‚ã›ã‚‹","å®‰å…¨ã‚µã‚¤ãƒ‰ææ¡ˆ","å¼·æŒ¯","ç„¡è¨€"],
    answer:1, explanation:"ãƒªã‚¹ã‚¯ç®¡ç†ãŒä¸Šç´šåˆ¤æ–­ã€‚"},

    {question:"æ± è¶Šãˆã‚·ãƒ§ãƒƒãƒˆã§è¿·ã„ã€‚æœ€å„ªå…ˆã¯ï¼Ÿ",
    choices:["æŒ‘æˆ¦ã•ã›ã‚‹","æˆåŠŸç¢ºç‡å…±æœ‰","æ€¥ãŒã›ã‚‹","ç„¡è¦–"],
    answer:1, explanation:"ç¢ºç‡æç¤ºãŒãƒ—ãƒ­ã€‚"},

    {question:"ã‚°ãƒªãƒ¼ãƒ³ãŒæ¥µç«¯ã«é€Ÿã„æ—¥ã€‚ä½•ã‚’å¼·èª¿ã™ã‚‹ï¼Ÿ",
    choices:["æ›²ãŒã‚Š","å¼·ã•","æ‰“ç‚¹","ãƒ•ã‚©ãƒ¼ãƒ "],
    answer:1, explanation:"é€Ÿã„æ—¥ã¯ã‚¿ãƒƒãƒé‡è¦–ã€‚"},

    {question:"ç«¶æŠ€çµ‚ç›¤1æ‰“å·®ã€‚åŸºæœ¬å§¿å‹¢ã¯ï¼Ÿ",
    choices:["åŠ±ã¾ã™","ä½™è¨ˆãªæƒ…å ±ã‚’å‡ºã•ãªã„","å¼·æ°—ç™ºè¨€","é›‘è«‡"],
    answer:1, explanation:"å†·é™ãªæƒ…å ±ç®¡ç†ã€‚"},

    {question:"ä½“èª¿ä¸è‰¯ã‚’è¨´ãˆãŸå ´åˆã¯ï¼Ÿ",
    choices:["ç¶šè¡Œ","å³å ±å‘Šã¨ä¼‘æ†©ææ¡ˆ","ç„¡è¦–","æ§˜å­è¦‹"],
    answer:1, explanation:"å®‰å…¨é…æ…®ç¾©å‹™ã€‚"},

    {question:"è·é›¢æ­ã¨GPSãŒ5yé•ã†ã€‚ã©ã†ã™ã‚‹ï¼Ÿ",
    choices:["æ­å„ªå…ˆ","GPSå„ªå…ˆ","ä¸¡æ–¹èª¬æ˜ã—åˆ¤æ–­å§”ã­ã‚‹","ç„¡è¦–"],
    answer:2, explanation:"æƒ…å ±ã‚’æç¤ºã—å§”ã­ã‚‹ã€‚"},

    {question:"ãƒãƒ³ã‚«ãƒ¼é¡ãŒé«˜ã„ã€‚æœ€å„ªå…ˆã¯ï¼Ÿ",
    choices:["è·é›¢","é«˜ã•","è„±å‡º","å¼·æŒ¯"],
    answer:2, explanation:"ã¾ãšè„±å‡ºã€‚"},

    {question:"å¼·é¢¨æ¨ªé¢¨ã‚·ãƒ§ãƒƒãƒˆã§é‡è¦ãªã®ã¯ï¼Ÿ",
    choices:["é«˜ã•","æ›²ãŒã‚Šå¹…","ç•ªæ‰‹","ç„¡è¦–"],
    answer:1, explanation:"æ¨ªé¢¨ã¯æ›²ãŒã‚Šå¹…è€ƒæ…®ã€‚"},

    {question:"åŒä¼´è€…ãŒãƒ©ã‚¤ãƒ³ã‚’è¸ã¿ãã†ã€‚ã©ã†ã™ã‚‹ï¼Ÿ",
    choices:["æ³¨æ„ã—ãªã„","ã‚„ã‚“ã‚ã‚Šå£°ã‹ã‘","å¼·ãæ³¨æ„","ç„¡è¦–"],
    answer:1, explanation:"é›°å›²æ°—ã‚’å£Šã•ãšæ³¨æ„ã€‚"},

    {question:"èª¤æ‰€ã‹ã‚‰æ‰“ã¡ãã†ãªæ™‚ã¯ï¼Ÿ",
    choices:["é»™ã‚‹","å³æŒ‡æ‘˜","ã‚ã¨ã§è¨€ã†","ä»»ã›ã‚‹"],
    answer:1, explanation:"é‡å¤§é•åé˜²æ­¢ã€‚"},

    {question:"ãƒ‰ãƒƒã‚°ãƒ¬ãƒƒã‚°å³ã€æ—è¶Šãˆç‹™ã„ã€‚åŸºæœ¬ã¯ï¼Ÿ",
    choices:["æ”»ã‚æ¨å¥¨","å®‰å…¨ãƒ«ãƒ¼ãƒˆææ¡ˆ","ç„¡è¨€","å¼·æŒ¯ææ¡ˆ"],
    answer:1, explanation:"æˆåŠŸç‡é‡è¦–ã€‚"},

    {question:"ãƒ—ãƒ¬ãƒ¼ãƒ¤ãƒ¼ãŒç•ªæ‰‹ã«è¿·ã†æ™‚ã¯ï¼Ÿ",
    choices:["å³æ±ºã‚ã‚‹","æ ¹æ‹ æç¤º","æ”¾ç½®","å¼·åˆ¶"],
    answer:1, explanation:"ãƒ‡ãƒ¼ã‚¿ã¨çŠ¶æ³å…±æœ‰ã€‚"},

    {question:"ã‚°ãƒªãƒ¼ãƒ³å¥¥ãŒOBã€‚ç‹™ã„æ‰€ã¯ï¼Ÿ",
    choices:["ãƒ”ãƒ³å¥¥","ãƒ”ãƒ³æ¨ª","æ‰‹å‰å®‰å…¨","çœŸã£ç›´ã"],
    answer:2, explanation:"å¥¥ã¯çµ¶å¯¾é¿ã‘ã‚‹ã€‚"},

    {question:"æš«å®šçƒå®£è¨€å¿˜ã‚Œãã†ã€‚ã©ã†ã™ã‚‹ï¼Ÿ",
    choices:["é»™ã‚‹","å®£è¨€ç¢ºèª","å¾Œã§ä¼ãˆã‚‹","ç„¡è¦–"],
    answer:1, explanation:"å®£è¨€ç¢ºèªã¯é‡è¦ã€‚"},

    {question:"æœ€ã‚‚ä¸Šç´šã‚­ãƒ£ãƒ‡ã‚£ãƒ¼ã«å¿…è¦ãªåŠ›ã¯ï¼Ÿ",
    choices:["ç­‹åŠ›","æƒ…å ±æ•´ç†åŠ›","å£°é‡","é€Ÿã•"],
    answer:1, explanation:"ç·åˆåˆ¤æ–­åŠ›ï¼æƒ…å ±æ•´ç†åŠ›ã€‚"}
  ];

  const master = [
    {question:"ãƒ—ãƒ¬ãƒ¼ãƒ¤ãƒ¼ã®çƒãŒå‹•ã„ãŸã‹ä¸æ˜ã€‚å¼·é¢¨ä¸‹ã§ã®åˆå‹•ã¯ï¼Ÿ",
    choices:["ç„¡è¦–ã—ã¦ç¶šè¡Œ","å³1ç½°æ‰“ã‚’å®£å‘Š","çŠ¶æ³ç¢ºèªã—è¦å‰‡ã‚’èª¬æ˜","å¾Œã§ãƒã‚¹ã‚¿ãƒ¼å®¤ã¸å ±å‘Š"],
    answer:2, explanation:"ã¾ãšäº‹å®Ÿç¢ºèªã€‚åŸå› ãŒè‡ªç„¶ç¾è±¡ãªã‚‰ç½°ãªã—ã€‚åˆ¤æ–­ã‚’æ€¥ãŒãªã„ã€‚"},

    {question:"OBã®å¯èƒ½æ€§ãŒé«˜ã„ãŒæš«å®šçƒå®£è¨€ã‚’å¿˜ã‚Œã¦æ‰“ã£ãŸã€‚çµæœã¯ï¼Ÿ",
    choices:["æš«å®šæ‰±ã„ã«ãªã‚‹","å…ƒã®çƒå„ªå…ˆ","æ–°ã—ã„çƒãŒã‚¤ãƒ³ãƒ—ãƒ¬ãƒ¼","ç„¡åŠ¹ã«ãªã‚‹"],
    answer:2, explanation:"å®£è¨€ãªã—ã¯æš«å®šçƒã«ãªã‚‰ãšã€æ–°çƒãŒã‚¤ãƒ³ãƒ—ãƒ¬ãƒ¼ã€‚"},

    {question:"æ•‘æ¸ˆã‚¨ãƒªã‚¢ã«ãƒ‰ãƒ­ãƒƒãƒ—å¾Œã€2å›ã¨ã‚‚ã‚¨ãƒªã‚¢å¤–ã«è»¢ãŒã£ãŸå ´åˆã¯ï¼Ÿ",
    choices:["ãã®ã¾ã¾ãƒ—ãƒ¬ãƒ¼","å†ãƒ‰ãƒ­ãƒƒãƒ—","ãƒ—ãƒ¬ãƒ¼ã‚¹ã™ã‚‹","1ç½°æ‰“è¿½åŠ "],
    answer:2, explanation:"2å›å¤±æ•—å¾Œã¯ãƒ—ãƒ¬ãƒ¼ã‚¹ã€‚"},

    {question:"åŒä¼´ç«¶æŠ€è€…ãŒé‡å¤§ãªè¦å‰‡é•åã«æ°—ã¥ã„ã¦ã„ãªã„ã€‚ã©ã†ã™ã‚‹ï¼Ÿ",
    choices:["é»™ã‚‹","æœ¬äººã¸äº‹å®Ÿç¢ºèªã‚’ä¿ƒã™","å¾Œã§ä¼ãˆã‚‹","ç„¡è¦–ã™ã‚‹"],
    answer:1, explanation:"ç«¶æŠ€ã§ã¯äº‹å®Ÿç¢ºèªã‚’ä¿ƒã™é…æ…®ãŒå¿…è¦ã€‚"},

    {question:"ã‚°ãƒªãƒ¼ãƒ³ä¸Šã§ãƒ©ã‚¤ãƒ³ã‚’è¸ã‚“ã§ã—ã¾ã£ãŸã€‚ç¾åœ¨ã®è¦å‰‡ã§ã¯ï¼Ÿ",
    choices:["2ç½°æ‰“","1ç½°æ‰“","ç½°ãªã—","å¤±æ ¼"],
    answer:2, explanation:"ç¾åœ¨ã¯ç½°ãªã—ã€‚ãŸã ã—ãƒãƒŠãƒ¼ä¸Šã®å•é¡Œã¯ã‚ã‚‹ã€‚"},

    {question:"é›·é³´ç¢ºèªã€‚ç«¶æŠ€å§”å“¡ã®æŒ‡ç¤ºå‰ã§ã‚‚ã‚­ãƒ£ãƒ‡ã‚£ãƒ¼ãŒå–ã‚‹ã¹ãè¡Œå‹•ã¯ï¼Ÿ",
    choices:["æŒ‡ç¤ºå¾…ã¡","è‡ªå·±åˆ¤æ–­ã§å®‰å…¨ç¢ºä¿ææ¡ˆ","ç¶šè¡Œä¿ƒé€²","ç„¡è¦–"],
    answer:1, explanation:"å®‰å…¨é…æ…®ã¯æœ€å„ªå…ˆã€‚"},

    {question:"ãƒ—ãƒ¬ãƒ¼ãƒ¤ãƒ¼ãŒã‚¯ãƒ©ãƒ–æœ¬æ•°è¶…éã«æ°—ä»˜ã„ãŸã€‚æ­£ã—ã„å‡¦ç½®ã¯ï¼Ÿ",
    choices:["ç½°ãªã—ã§ç¶šè¡Œ","å³å¤±æ ¼","è¶…éåˆ†ã‚’å®£è¨€ã—ç½°æ‰“é©ç”¨","é»™ã£ã¦æŠœã"],
    answer:2, explanation:"è¶…éã‚¯ãƒ©ãƒ–ã¯ç½°æ‰“ï¼ˆæœ€å¤§4æ‰“ï¼‰ã€‚"},

    {question:"çƒãŒè‡ªåˆ†ã®ãƒãƒƒã‚°ã«å¶ç„¶å½“ãŸã£ãŸå ´åˆã¯ï¼Ÿ",
    choices:["ç½°ãªã—","1ç½°æ‰“","2ç½°æ‰“","å¤±æ ¼"],
    answer:1, explanation:"å¶ç„¶ã§ã‚‚ãƒ—ãƒ¬ãƒ¼ãƒ¤ãƒ¼å´ã«å½“ãŸã‚Œã°1ç½°æ‰“ã€‚"},

    {question:"ãƒ—ãƒ¬ãƒ¼ãƒ¤ãƒ¼ãŒæ„Ÿæƒ…çš„ã«ãªã‚Šè¦å‰‡ã‚’ç„¡è¦–ã—ã‚ˆã†ã¨ã—ã¦ã„ã‚‹ã€‚æœ€å–„ã¯ï¼Ÿ",
    choices:["å¼·ãåˆ¶æ­¢","å…±æ„Ÿã—ã¤ã¤è¦å‰‡ã‚’å†·é™ã«èª¬æ˜","æ”¾ç½®","å§”å“¡ã¸å³é€šå ±ã®ã¿"],
    answer:1, explanation:"æ„Ÿæƒ…ã¨è¦å‰‡ã®ä¸¡ç«‹ãŒä¸Šç´šã‚­ãƒ£ãƒ‡ã‚£ãƒ¼ã®ä»•äº‹ã€‚"},

    {question:"æœ€çµ‚ãƒ›ãƒ¼ãƒ«1æ‰“å·®é¦–ä½ã€‚ã‚­ãƒ£ãƒ‡ã‚£ãƒ¼ã¨ã—ã¦æœ€ã‚‚é‡è¦ãªã®ã¯ï¼Ÿ",
    choices:["æ”»ã‚ã•ã›ã‚‹","æƒ…å ±ã‚’æœ€å°é™ã«æ•´ç†ã—å†·é™ç¶­æŒ","å¼·ãé¼“èˆã™ã‚‹","è¦³å®¢ã‚’æ°—ã«ã™ã‚‹"],
    answer:1, explanation:"çµ‚ç›¤ã¯æƒ…å ±éå¤šã‚’é¿ã‘ã€å†·é™ç¶­æŒãŒæœ€é‡è¦ã€‚"}
  ];

  // =====================
  function showMenu(){
    const savedName = (localStorage.getItem(LS_NAME) || "").trim();
    let html = "<h1>â›³ ã‚­ãƒ£ãƒ‡ã‚£ãƒ¼ç ”ä¿®ç”¨ã‚¯ã‚¤ã‚º</h1>";
    html += "<div class='center'>";
    if(savedName){
      html += "<span class='pill'>ã‚ˆã†ã“ãï¼š " + escapeHtml(savedName) + " ã•ã‚“</span>";
      html += "<button onclick='selectLevelFromMenu()'>â–¶ ãƒ¬ãƒ™ãƒ«é¸æŠã¸</button>";
      html += "<button class='btnGhost' onclick='nameInput()'>âœï¸ åå‰ã‚’å¤‰æ›´ã—ã¦é–‹å§‹</button>";
    }else{
      html += "<button onclick='nameInput()'>â–¶ ã‚²ãƒ¼ãƒ é–‹å§‹</button>";
    }
    html += "<button class='btnSecondary' onclick='showAdminLogin()'>ğŸ”’ ç®¡ç†è€…</button>";
    html += "</div>";
    document.getElementById("gameArea").innerHTML = html;
  }

  function selectLevelFromMenu(){
    const savedName = (localStorage.getItem(LS_NAME) || "").trim();
    if(!savedName){
      nameInput();
      return;
    }
    playerName = savedName;
    selectLevel(); // nameBoxãŒç„¡ãã¦ã‚‚å‹•ãã‚ˆã†ã« selectLevel å†…ã§å¯¾å¿œæ¸ˆã¿ã«ã™ã‚‹
  }

  // =====================
  function nameInput(){
    let html = "<h2>åå‰ã‚’å…¥åŠ›</h2>";
    html += "<input id='nameBox' placeholder='ä¾‹ï¼šå±±ç”°å¤ªéƒ' style='padding:12px;width:90%;font-size:18px;'><br><br>";
    html += "<button onclick='selectLevel()'>æ¬¡ã¸</button>";
    html += "<button class='btnSecondary' onclick='showMenu()'>æˆ»ã‚‹</button>";
    document.getElementById("gameArea").innerHTML = html;

    setTimeout(() => {
      const el = document.getElementById("nameBox");
      if(el) el.focus();
    }, 0);
  }

  function selectLevel(){
    // nameInputçµŒç”±ãªã‚‰ nameBoxã€ãƒ¡ãƒ‹ãƒ¥ãƒ¼çµŒç”±ãªã‚‰ localStorage ã®åå‰ã‚’ä½¿ã†
    const el = document.getElementById("nameBox");
    const fromInput = el ? (el.value || "").trim() : "";
    if(fromInput){
      playerName = fromInput;
      localStorage.setItem(LS_NAME, playerName);
    }else{
      const saved = (localStorage.getItem(LS_NAME) || "").trim();
      if(saved) playerName = saved;
    }

    if(!playerName){
      alert("åå‰ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„");
      return;
    }

    let html = "<h2>ãƒ¬ãƒ™ãƒ«é¸æŠ</h2>";
    html += "<div class='center'><span class='pill'>" + escapeHtml(playerName) + " ã•ã‚“</span></div>";
    html += "<button onclick='startLevel(\"beginner\")'>åˆç´š</button>";
    html += "<button onclick='startLevel(\"intermediate\")'>ä¸­ç´š</button>";
    html += "<button onclick='startLevel(\"advanced\")'>ä¸Šç´š</button>";
    if(progress.beginner && progress.intermediate && progress.advanced){
      html += "<button onclick='startLevel(\"master\")'>ğŸ”¥ è¶…ä¸Šç´š</button>";
    }
    html += "<button class='btnGhost' onclick='nameInput()'>åå‰å¤‰æ›´</button>";
    html += "<button class='btnSecondary' onclick='showMenu()'>ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã¸</button>";
    document.getElementById("gameArea").innerHTML = html;
  }

  // =====================
  function startLevel(level){
    currentLevel = level;
    currentQuestion = 0;
    score = 0;

    if(level==="beginner") quizData = beginner;
    if(level==="intermediate") quizData = intermediate;
    if(level==="advanced") quizData = advanced;
    if(level==="master") quizData = master;

    loadQuestion();
  }

  // =====================
  function loadQuestion(){
    let q = quizData[currentQuestion];
    let options = [];
    for(let i=0;i<q.choices.length;i++){
      options.push({text:q.choices[i], correct:i===q.answer, originalIndex:i});
    }
    shuffleArray(options);

    let html = "<div class='center'>";
    html += "<span class='pill'>" + levelLabel(currentLevel) + "</span>";
    html += "<span class='pill'>" + escapeHtml(playerName) + " ã•ã‚“</span>";
    html += "</div>";

    html += "<h2>ç¬¬"+(currentQuestion+1)+"å• / "+quizData.length+"</h2>";
    html += "<p>"+escapeHtml(q.question)+"</p>";

    for(let i=0;i<options.length;i++){
      html += "<button class='choice' onclick='checkAnswer("+i+")' id='btn"+i+"'>"+escapeHtml(options[i].text)+"</button>";
    }

    html += "<div id='feedback'></div>";
    html += "<button class='btnGhost' onclick='selectLevel()'>ãƒ¬ãƒ™ãƒ«é¸æŠã¸æˆ»ã‚‹</button>";

    document.getElementById("gameArea").innerHTML = html;
    window.currentOptions = options;
  }

  // =====================
  // âœ… æ”¹å–„ãƒã‚¤ãƒ³ãƒˆï¼šå›ç­”å¾Œã™ãæ¬¡ã¸è¡Œã‹ãšã€è§£èª¬ã‚’æŒŸã‚€ï¼ˆæ­£è§£ã‚‚åˆ†ã‹ã‚Šã‚„ã™ãï¼‰
  // =====================
  function checkAnswer(index){
    let q = quizData[currentQuestion];
    let buttons = document.querySelectorAll(".choice");
    buttons.forEach((btn,i)=> btn.disabled = true);

    const picked = window.currentOptions[index];
    const isCorrect = !!picked.correct;
    if(isCorrect) score++;

    // ã‚¯ãƒªãƒƒã‚¯ã—ãŸãƒœã‚¿ãƒ³ã®è‰²
    const pickedBtn = document.getElementById("btn"+index);
    if(pickedBtn){
      pickedBtn.classList.add(isCorrect ? "correct" : "wrong");
    }

    // ä¸æ­£è§£ãªã‚‰ã€æ­£è§£ã®ãƒœã‚¿ãƒ³ã‚‚å¼·èª¿è¡¨ç¤º
    if(!isCorrect){
      buttons.forEach((btn,i)=>{
        if(window.currentOptions[i].correct){
          btn.classList.add("correct","revealCorrect");
        }
      });
    }

    // æ­£è§£ãƒ†ã‚­ã‚¹ãƒˆï¼ˆå…ƒã®choicesã‹ã‚‰ï¼‰
    const correctText = q.choices[q.answer];

    // è§£èª¬ã‚¨ãƒªã‚¢
    let fb = "";
    fb += "<div class='explainBox'>";
    fb += "<div class='explainTitle'>" + (isCorrect ? "â­• æ­£è§£ï¼" : "âŒ ä¸æ­£è§£") + "</div>";
    if(!isCorrect){
      fb += "<div style='margin-bottom:8px;'>æ­£è§£ï¼š<strong>" + escapeHtml(correctText) + "</strong></div>";
    }
    fb += "<div>" + escapeHtml(q.explanation || "ï¼ˆè§£èª¬ãŒæœªè¨­å®šã§ã™ï¼‰") + "</div>";
    fb += "<button style='margin-top:12px;' onclick='nextQuestion()'>" + ((currentQuestion+1<quizData.length) ? "æ¬¡ã®å•é¡Œã¸" : "çµæœã‚’è¦‹ã‚‹") + "</button>";
    fb += "</div>";

    document.getElementById("feedback").innerHTML = fb;
  }

  // =====================
  function nextQuestion(){
    currentQuestion++;
    if(currentQuestion < quizData.length){
      loadQuestion();
    } else {
      showResult();
    }
  }

  // =====================
  // âœ… æ”¹å–„ãƒã‚¤ãƒ³ãƒˆï¼šçµ‚äº†å¾Œã¯ã€Œåå‰å…¥åŠ›ã€ã§ã¯ãªãã€Œãƒ¬ãƒ™ãƒ«é¸æŠã€ã¸
  // =====================
  function showResult(){
    let rate = Math.round((score/quizData.length)*100);
    let rank = getRank(rate);

    if(rate >= 70){
      progress[currentLevel] = true;
      localStorage.setItem("caddieProgress", JSON.stringify(progress));
    }

    let resultData = {
      name: playerName,
      level: currentLevel,
      score: score,
      total: quizData.length,
      rate: rate,
      rank: rank,
      date: new Date().toLocaleString()
    };

    logs.push(resultData);
    localStorage.setItem("caddieLogs", JSON.stringify(logs));

    sendToGoogle(resultData);

    let html = "<h1>çµæœ</h1>";
    html += "<div class='center'><span class='pill'>" + levelLabel(currentLevel) + "</span></div>";
    html += "<p class='center' style='font-size:18px;'>" + score + " / " + quizData.length + "</p>";
    html += "<h2 class='center'>" + rate + "%</h2>";
    html += "<h2 class='center'>" + rank + "</h2>";

    html += "<div class='explainBox'>";
    html += "<div class='explainTitle'>æ¬¡ã®ãŠã™ã™ã‚</div>";
    html += "<div>ãƒ»é–“é•ãˆãŸå•é¡Œã®è§£èª¬ã‚’ã‚‚ã†ä¸€åº¦èª­ã‚€ â†’ åŒãƒ¬ãƒ™ãƒ«å†æŒ‘æˆ¦ãŒæœ€çŸ­ã§ä¼¸ã³ã¾ã™ã€‚</div>";
    html += "</div>";

    html += "<button onclick='selectLevel()'>ãƒ¬ãƒ™ãƒ«é¸æŠã¸</button>";
    html += "<button class='btnSecondary' onclick='startLevel(\""+currentLevel+"\")'>åŒã˜ãƒ¬ãƒ™ãƒ«ã‚’ã‚‚ã†ä¸€åº¦</button>";
    html += "<button class='btnGhost' onclick='showMenu()'>ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã¸</button>";

    document.getElementById("gameArea").innerHTML = html;
  }

  // =====================
  // Googleé€ä¿¡
  // =====================
  function sendToGoogle(data){
    if(GOOGLE_SCRIPT_URL === "ã“ã“ã«GASã®URLã‚’è²¼ã‚‹") return;
    fetch(GOOGLE_SCRIPT_URL, {
      method:"POST",
      mode:"no-cors",
      headers:{"Content-Type":"application/json"},
      body: JSON.stringify(data)
    });
  }

  // =====================
  // ç®¡ç†è€…ãƒšãƒ¼ã‚¸
  // =====================
  function showAdminLogin(){
    let html="<h2>ç®¡ç†è€…ãƒ­ã‚°ã‚¤ãƒ³</h2>";
    html+="<input type='password' id='adminPass' placeholder='ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰'><br><br>";
    html+="<button onclick='checkAdmin()'>ãƒ­ã‚°ã‚¤ãƒ³</button>";
    html+="<button class='btnSecondary' onclick='showMenu()'>æˆ»ã‚‹</button>";
    document.getElementById("gameArea").innerHTML=html;
  }

  function checkAdmin(){
    if(document.getElementById("adminPass").value==="tkhr7272"){
      showAdmin();
    }else{
      alert("ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰é•ã„ã¾ã™");
    }
  }

  function showAdmin(){
    let html="<h2>æˆç¸¾ä¸€è¦§</h2>";
    if(!logs.length){
      html += "<p class='center'>ã¾ã è¨˜éŒ²ãŒã‚ã‚Šã¾ã›ã‚“</p>";
    }else{
      logs.slice().reverse().forEach(log=>{
        html += "<p>"+escapeHtml(log.date)+" | "+escapeHtml(log.name)+" | "+escapeHtml(log.level)+" | "+log.rate+"% | "+escapeHtml(log.rank)+"</p>";
      });
    }
    html+="<button onclick='showMenu()'>æˆ»ã‚‹</button>";
    document.getElementById("gameArea").innerHTML=html;
  }

  function escapeHtml(str){
    return String(str)
      .replaceAll("&","&amp;")
      .replaceAll("<","&lt;")
      .replaceAll(">","&gt;")
      .replaceAll('"',"&quot;")
      .replaceAll("'","&#039;");
  }

  // =====================
  showMenu();
  </script>
</body>
</html>
