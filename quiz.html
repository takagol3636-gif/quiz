キャディー研修クイズ塩嶺モード追加版

<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>キャディー研修用クイズ</title>

  <style>
    body{
      margin:0;
      font-family: system-ui, -apple-system, "Segoe UI", Roboto, "Hiragino Kaku Gothic ProN", "Noto Sans JP", "Yu Gothic", sans-serif;
      background:#0b3d0b;
      color:white;
      text-align:center;
    }
    .container{
      max-width:700px;
      margin:auto;
      padding:20px;
    }
    .card{
      background:rgba(0,0,0,0.85);
      padding:20px;
      border-radius:12px;
      text-align:left;
    }
    h1,h2{ text-align:center; margin: 0 0 12px 0; }

/* タイトルのサイズをスマホ最適化 */
h1{
  font-size: clamp(22px, 6vw, 36px); /* 小〜大を自動調整 */
  line-height: 1.2;
  margin: 0 0 14px 0;
  text-align: center;
  letter-spacing: 0.02em;
}

h1{
  padding: 0 6px;           /* 端の余白 */
  text-wrap: balance;       /* 対応ブラウザで改行バランス改善 */
}

    p{ line-height:1.6; }

    button{
      width:100%;
      padding:15px;
      margin:8px 0;
      font-size:16px;
      border:none;
      border-radius:10px;
      background:#1b5e20;
      color:white;
      -webkit-tap-highlight-color: transparent;
      cursor:pointer;
    }
    button:disabled{opacity:0.6; cursor:not-allowed;}
    .btnSecondary{ background:#2c2c2c; }
    .btnGhost{ background:transparent; border:1px solid rgba(255,255,255,0.25); }

    .correct{background:#1f7a1f !important;}
    .wrong{background:#8b1a1a !important;}
    .revealCorrect{ outline:2px solid rgba(255,255,255,0.45); }

    #adminPanel{display:none;}

    input{
      width:90%;
      padding:12px;
      font-size:18px;
      box-sizing:border-box;
      border-radius:10px;
      border:none;
      outline:none;
    }

    .pill{
      display:inline-block;
      padding:6px 10px;
      border-radius:999px;
      background:rgba(255,255,255,0.12);
      font-size:13px;
      margin:0 6px 10px 0;
    }
    .center{ text-align:center; }

    .explainBox{
      margin-top:12px;
      padding:14px;
      border-radius:12px;
      background:rgba(255,255,255,0.08);
    }
    .explainTitle{ font-weight:700; margin-bottom:8px; }
    .muted{ opacity:0.85; font-size:14px; text-align:center; }

    /* ===== 塩嶺CCモード用（追加） ===== */
    .holeImgWrap{
      margin:10px 0 12px;
      text-align:center;
    }
    .holeImg{
      max-width:100%;
      height:auto;
      border-radius:10px;
      border:1px solid rgba(255,255,255,0.18);
      display:block;
      margin:0 auto;
    }
    .smallNote{
      font-size:12px;
      opacity:0.8;
      margin-top:6px;
      text-align:center;
    }
  </style>
</head>

<body>
  <div class="container">
    <div class="card" id="gameArea"></div>
    <p class="muted">不正解時：正解強調＋解説 → 次へ｜終了後：レベル選択へ戻る</p>
  </div>

  <script>
  "use strict";

  // =====================
  // ★ Google保存URLを入れる（必要なら）
  // =====================
  const GOOGLE_SCRIPT_URL = "ここにGASのURLを貼る";

  // =====================
  // localStorage keys
  // =====================
  const LS_NAME = "caddieQuiz_name";

  // =====================
  // 変数
  // =====================
  let currentLevel = "";
  let currentQuestion = 0;
  let score = 0;
  let quizData = [];
  let playerName = "";

  // 選択肢（シャッフル後の正誤判定用）
  window.currentOptions = [];

  // 進捗とログ（端末内に保存）
  let progress = JSON.parse(localStorage.getItem("caddieProgress")) || {
    beginner:false,
    intermediate:false,
    advanced:false,
    master:false
  };

  let logs = JSON.parse(localStorage.getItem("caddieLogs")) || [];

  // =====================
  function shuffleArray(array){
    for(let i=array.length-1;i>0;i--){
      let j=Math.floor(Math.random()*(i+1));
      [array[i],array[j]]=[array[j],array[i]];
    }
    return array;
  }

  // =====================
  // ★ ランク判定
  // =====================
  function getRank(rate){
    if(rate===100)return "👑 SSS";
    if(rate>=90)return "🏆 S";
    if(rate>=80)return "🥇 A";
    if(rate>=70)return "🥈 B";
    if(rate>=60)return "🥉 C";
    return "🔰 D";
  }

  function levelLabel(level){
    if(level==="beginner") return "初級";
    if(level==="intermediate") return "中級";
    if(level==="advanced") return "上級";
    if(level==="master") return "🔥 超上級";
    if(level==="shionre") return "🏞 塩嶺CC専用";
    return level;
  }

  // =====================
  // 問題データ（既存）
  // =====================
  const beginner = [
    {question:"キャディーの基本姿勢として最も重要なのは？",
    choices:["スピード","笑顔と礼儀","距離感覚","声量"],
    answer:1, explanation:"第一印象は笑顔と礼儀で決まる。"},

    {question:"ティーグラウンドで最初に確認するのは？",
    choices:["風向き","ピン位置","使用ティー","前組の位置"],
    answer:3, explanation:"安全確認が最優先。"},

    {question:"残り距離を伝える時に必要なのは？",
    choices:["自信","勘","正確な計測","経験則のみ"],
    answer:2, explanation:"正確な距離が基本。"},

    {question:"バンカー均しで正しいのは？",
    choices:["足跡だけ均す","全体をレーキで均す","放置","打った場所だけ均す"],
    answer:1, explanation:"全体を丁寧に均す。"},

    {question:"OBの正式名称は？",
    choices:["Out Ball","Official Boundary","Out of Bounds","Outside Birdie"],
    answer:2, explanation:"Out of Boundsの略。"},

    {question:"グリーン上で走って良い？",
    choices:["OK","状況次第","基本NG","急げば可"],
    answer:2, explanation:"芝保護のため走らない。"},

    {question:"お客様のクラブ確認はいつ？",
    choices:["前日","常時","スタート前","終わってから"],
    answer:2, explanation:"渡す前に必ず確認。"},

    {question:"プレーファストの基本は？",
    choices:["急がせる","準備の徹底","無言","走る"],
    answer:1, explanation:"準備を整えることが重要。"},

    {question:"ボールマーク修復は誰の仕事？",
    choices:["キャディー","お客様","見つけた人","全員"],
    answer:3, explanation:"見つけた人が直すのがマナー。"},

    {question:"雨天時優先すべきは？",
    choices:["速度","安全","売上","演出"],
    answer:1, explanation:"安全最優先。"}
  ];

  const intermediate = [
    {question:"向かい風5m、150yの目安は？",
    choices:["そのまま","1番手上げ","2番手上げ","下げる"],
    answer:1, explanation:"基本は1番手上げ。"},

    {question:"フォロー風の注意点は？",
    choices:["飛ばない","止まりにくい","曲がる","短くなる"],
    answer:1, explanation:"ランが出る。"},

    {question:"硬いグリーンの狙いは？",
    choices:["奥","ピン","手前","無視"],
    answer:2, explanation:"手前から攻める。"},

    {question:"誤球防止で重要なのは？",
    choices:["色確認","番号確認","メーカー確認","全部"],
    answer:3, explanation:"全確認が基本。"},

    {question:"雷鳴が聞こえたら？",
    choices:["続行","様子見","避難提案","急ぐ"],
    answer:2, explanation:"即安全確保。"},

    {question:"深いラフの番手選択は？",
    choices:["上げる","下げる","変えない","強振"],
    answer:1, explanation:"脱出優先で下げる判断も重要。"},

    {question:"下りパットで重要なのは？",
    choices:["強く","弱く","真っ直ぐ","無視"],
    answer:1, explanation:"タッチ重視。"},

    {question:"競技で距離計は？",
    choices:["自由","禁止","条件付き可","無関係"],
    answer:2, explanation:"高低差表示禁止の場合が多い。"},

    {question:"暫定球宣言が無い場合？",
    choices:["有効","無効","後でOK","無視"],
    answer:1, explanation:"宣言なしは暫定球にならない。"},

    {question:"球探し制限時間は？",
    choices:["3分","5分","2分","無制限"],
    answer:0, explanation:"3分ルール。"},

    {question:"アンプレは誰が出来る？",
    choices:["キャディー","同伴者","本人","競技委員"],
    answer:2, explanation:"プレーヤー本人のみ。"},

    {question:"打順の基本は？",
    choices:["若い順","遠い順","速い順","申告順"],
    answer:1, explanation:"ホールから遠い順。"},

    {question:"ピンを抜く判断は？",
    choices:["必ず抜く","必ず立てる","状況次第","無視"],
    answer:2, explanation:"現在は立てたままでもOK。"},

    {question:"傾斜地での助言は？",
    choices:["強く","通常通り","1番手上げ","状況説明"],
    answer:3, explanation:"傾斜説明が重要。"},

    {question:"林の中で優先は？",
    choices:["距離","方向","脱出","ピン"],
    answer:2, explanation:"脱出優先。"},

    {question:"朝露グリーンは？",
    choices:["速い","遅い","普通","読めない"],
    answer:1, explanation:"重くなる傾向。"},

    {question:"競技中アドバイス範囲は？",
    choices:["全面OK","禁止","規則内","自由"],
    answer:2, explanation:"規則内のみ可。"},

    {question:"打球が他人に当たったら？",
    choices:["無効","罰","原則そのまま","打ち直し"],
    answer:2, explanation:"原則そのまま。"},

    {
  question:"池越えの場面でキャディーが最優先で確認すべきことは？",
  choices:["ピン位置","池までの正確な距離","グリーンの速さ","前の組との間隔"],
  answer:1,
  explanation:"池までの距離を正確に伝えることで、無理な判断を防ぐことができる。"
}, // ←これ！

{question:"プレーファスト最大要因は？",
 choices:["走る","準備","声出し","急がせる"],
 answer:1, explanation:"事前準備。"}
  ];

  const advanced = [
    {question:"競技中、プレーヤーが誤った距離を信じかけている。どう対応する？",
    choices:["黙る","即座に訂正","あとで伝える","同調する"],
    answer:1, explanation:"誤情報は即訂正が基本。"},

    {question:"残り150y、強いフォロー風。適切な提案は？",
    choices:["1番手上げる","1番手下げる","変えない","強振提案"],
    answer:1, explanation:"フォローは番手を下げる判断。"},

    {question:"下り5mのスライスライン。最重要要素は？",
    choices:["強さ","曲がり幅","距離感","真っ直ぐ打たせる"],
    answer:2, explanation:"下りは距離感が最優先。"},

    {question:"プレーヤーが苛立っている時の対応は？",
    choices:["理論説明","共感し落ち着かせる","無視","叱る"],
    answer:1, explanation:"心理サポートも役割。"},

    {question:"前組と2ホール空いた。まず何をする？",
    choices:["急がせる","状況共有と準備促進","マスター室無視","雑談"],
    answer:1, explanation:"冷静に状況共有。"},

    {question:"深いラフからピン狙い。最適助言は？",
    choices:["狙わせる","安全サイド提案","強振","無言"],
    answer:1, explanation:"リスク管理が上級判断。"},

    {question:"池越えショットで迷い。最優先は？",
    choices:["挑戦させる","成功確率共有","急がせる","無視"],
    answer:1, explanation:"確率提示がプロ。"},

    {question:"グリーンが極端に速い日。何を強調する？",
    choices:["曲がり","強さ","打点","フォーム"],
    answer:1, explanation:"速い日はタッチ重視。"},

    {question:"競技終盤1打差。基本姿勢は？",
    choices:["励ます","余計な情報を出さない","強気発言","雑談"],
    answer:1, explanation:"冷静な情報管理。"},

    {question:"体調不良を訴えた場合は？",
    choices:["続行","即報告と休憩提案","無視","様子見"],
    answer:1, explanation:"安全配慮義務。"},

    {question:"距離杭とGPSが5y違う。どうする？",
    choices:["杭優先","GPS優先","両方説明し判断委ねる","無視"],
    answer:2, explanation:"情報を提示し委ねる。"},

    {question:"バンカー顎が高い。最優先は？",
    choices:["距離","高さ","脱出","強振"],
    answer:2, explanation:"まず脱出。"},

    {question:"強風横風ショットで重要なのは？",
    choices:["高さ","曲がり幅","番手","無視"],
    answer:1, explanation:"横風は曲がり幅考慮。"},

    {question:"同伴者がラインを踏みそう。どうする？",
    choices:["注意しない","やんわり声かけ","強く注意","無視"],
    answer:1, explanation:"雰囲気を壊さず注意。"},

    {question:"誤所から打ちそうな時は？",
    choices:["黙る","即指摘","あとで言う","任せる"],
    answer:1, explanation:"重大違反防止。"},

    {question:"ドッグレッグ右、林越え狙い。基本は？",
    choices:["攻め推奨","安全ルート提案","無言","強振提案"],
    answer:1, explanation:"成功率重視。"},

    {question:"プレーヤーが番手に迷う時は？",
    choices:["即決める","根拠提示","放置","強制"],
    answer:1, explanation:"データと状況共有。"},

    {question:"グリーン奥がOB。狙い所は？",
    choices:["ピン奥","ピン横","手前安全","真っ直ぐ"],
    answer:2, explanation:"奥は絶対避ける。"},

    {question:"暫定球宣言忘れそう。どうする？",
    choices:["黙る","宣言確認","後で伝える","無視"],
    answer:1, explanation:"宣言確認は重要。"},

    {question:"最も上級キャディーに必要な力は？",
    choices:["筋力","情報整理力","声量","速さ"],
    answer:1, explanation:"総合判断力＝情報整理力。"}
  ];

  const master = [
    {question:"プレーヤーの球が動いたか不明。強風下での初動は？",
    choices:["無視して続行","即1罰打を宣告","状況確認し規則を説明","後でマスター室へ報告"],
    answer:2, explanation:"まず事実確認。原因が自然現象なら罰なし。判断を急がない。"},

    {question:"OBの可能性が高いが暫定球宣言を忘れて打った。結果は？",
    choices:["暫定扱いになる","元の球優先","新しい球がインプレー","無効になる"],
    answer:2, explanation:"宣言なしは暫定球にならず、新球がインプレー。"},

    {question:"救済エリアにドロップ後、2回ともエリア外に転がった場合は？",
    choices:["そのままプレー","再ドロップ","プレースする","1罰打追加"],
    answer:2, explanation:"2回失敗後はプレース。"},

    {question:"同伴競技者が重大な規則違反に気づいていない。どうする？",
    choices:["黙る","本人へ事実確認を促す","後で伝える","無視する"],
    answer:1, explanation:"競技では事実確認を促す配慮が必要。"},

    {question:"グリーン上でラインを踏んでしまった。現在の規則では？",
    choices:["2罰打","1罰打","罰なし","失格"],
    answer:2, explanation:"現在は罰なし。ただしマナー上の問題はある。"},

    {question:"雷鳴確認。競技委員の指示前でもキャディーが取るべき行動は？",
    choices:["指示待ち","自己判断で安全確保提案","続行促進","無視"],
    answer:1, explanation:"安全配慮は最優先。"},

    {question:"プレーヤーがクラブ本数超過に気付いた。正しい処置は？",
    choices:["罰なしで続行","即失格","超過分を宣言し罰打適用","黙って抜く"],
    answer:2, explanation:"超過クラブは罰打（最大4打）。"},

    {question:"球が自分のバッグに偶然当たった場合は？",
    choices:["罰なし","1罰打","2罰打","失格"],
    answer:1, explanation:"偶然でもプレーヤー側に当たれば1罰打。"},

    {question:"プレーヤーが感情的になり規則を無視しようとしている。最善は？",
    choices:["強く制止","共感しつつ規則を冷静に説明","放置","委員へ即通報のみ"],
    answer:1, explanation:"感情と規則の両立が上級キャディーの仕事。"},

    {question:"最終ホール1打差首位。キャディーとして最も重要なのは？",
    choices:["攻めさせる","情報を最小限に整理し冷静維持","強く鼓舞する","観客を気にする"],
    answer:1, explanation:"終盤は情報過多を避け、冷静維持が最重要。"}
  ];

  // =====================
  // ===== 塩嶺CC専用モード（追加） =====
  // 各ホールに holeImg を付けて、問題画面に画像を表示します
  // ※画像URLは差し替えやすいように各問題の holeImg に入れてあります
  // =====================

  const shionre_shirakaba = [
    {question:"【しらかば1番】ティーショットで最も注意喚起すべきエリアはどこ？",
     choices:["右サイド","左サイド（OB方向）","グリーン奥","ティー前方バンカー"],
     answer:1,
     explanation:"打ち下ろしで距離が出やすく、左に流れるとOBになりやすい。打ち下ろし＝安全ではない点を事前に共有。",
     holeImg:"https://www.enrei.co.jp/wp-content/uploads/2016/12/shira-map01.jpg"
    },
    {question:"【しらかば2番】このホールでプレー前に必ず確認しておくべきことは？",
     choices:["ピン位置","グリーン傾斜","前組の位置（安全確認）","使用クラブ"],
     answer:2,
     explanation:"ブラインド要素があり打ち込み事故が起こりやすい。安全確認は距離案内より優先。",
     holeImg:"https://www.enrei.co.jp/wp-content/uploads/2016/12/shira-map02-1.jpg"
    },
    {question:"【しらかば3番（ロング）】セカンドで特に警戒すべきのは？",
     choices:["右OB","左クロスバンカー","グリーン手前の池","正面の林"],
     answer:1,
     explanation:"距離を出そうとすると左のクロスバンカーに捕まりやすい。欲張らず“次を打ちやすい場所”へ。",
     holeImg:"https://www.enrei.co.jp/wp-content/uploads/2016/12/shira-map03-1.jpg"
    },
    {question:"【しらかば4番】池越えの砲台グリーン。最も安全な基本戦略は？",
     choices:["ピンを正確に狙う","グリーン左サイド狙い","グリーンセンター狙い","池手前に刻む"],
     answer:2,
     explanation:"ピン狙い過多は池・バンカーのリスクが増える。“まず乗せる”を優先しセンター狙いが基本。",
     holeImg:"https://www.enrei.co.jp/wp-content/uploads/2016/12/shira-map04-1.jpg"
    },
    {question:"【しらかば5番】セカンドが極端に難しくなるミスは？",
     choices:["右サイド","左への引っかけ","フェアウェイ中央","手前刻み"],
     answer:1,
     explanation:"左に外すとグリーンへのラインが消えやすい。ティーショット時点で“左NG”を明確に。",
     holeImg:"https://www.enrei.co.jp/wp-content/uploads/2016/12/shira-map05-1.jpg"
    },
    {question:"【しらかば6番】ティーショットで最も避けたい球筋は？",
     choices:["軽いドロー","フェード","スライス・押し出し","低弾道"],
     answer:2,
     explanation:"右サイドにバンカーと林がありスライスは即トラブル。狙いは左サイドが無難。",
     holeImg:"https://www.enrei.co.jp/wp-content/uploads/2016/12/shira-map06-1.jpg"
    },
    {question:"【しらかば7番（ショート）】このホールで最も重視すべき要素は？",
     choices:["方向性","高さ","距離感（タッチ）","スピン量"],
     answer:2,
     explanation:"横長で奥行きが浅い。ショートもオーバーも大きなミスになるため距離感最優先。",
     holeImg:"https://www.enrei.co.jp/wp-content/uploads/2016/12/shira-map07-1.jpg"
    },
    {question:"【しらかば8番（ロング）】ティーショットで特に注意すべきポイントは？",
     choices:["左OB","右前方クロスバンカー","グリーン奥","手前の池"],
     answer:1,
     explanation:"バンカー越えは距離が必要。無理をすると大叩きに繋がるので安全なレイアップ判断も重要。",
     holeImg:"https://www.enrei.co.jp/wp-content/uploads/2016/12/shira-map08-1.jpg"
    },
    {question:"【しらかば9番】セカンドの距離は基本どう見積もる？",
     choices:["表示距離そのまま","1番手下げる","残り距離の約1割増し","風だけ見る"],
     answer:2,
     explanation:"強い打ち上げで見た目以上に距離がかかる。番手ミスを防ぐため補正を必ず共有。",
     holeImg:"https://www.enrei.co.jp/wp-content/uploads/2016/12/shira-map09-1.jpg"
    },
  ];

  const shionre_rindo = [
    {question:"【りんどう1番】ティーショットの狙い目（目標物）は？",
     choices:["200〜220yd先の松の右","左OBギリギリ","右バンカー上","フェアウェイ中央の木"],
     answer:0,
     explanation:"200〜220yd先の松の右が狙い目。松越え先はブラインドになりやすいので前組確認も必須。",
     holeImg:"https://www.enrei.co.jp/wp-content/uploads/2017/01/rin-map01-1.jpg"
    },
    {question:"【りんどう2番】ティーショットの基本の安全サイドは？",
     choices:["右サイド","左サイド","左ラフ","右ラフ"],
     answer:1,
     explanation:"打ち上げで距離もある。左サイド狙いが基本。グリーン左右手前の深いバンカーに注意。",
     holeImg:"https://www.enrei.co.jp/wp-content/uploads/2017/01/rin-map02-1.jpg"
    },
    {question:"【りんどう3番】ティーショットの狙い目は？",
     choices:["中央の檜の左","中央の檜の右","右端の白樺","左バンカー"],
     answer:1,
     explanation:"中央の檜の右サイドが狙い目。左OBは浅いので注意し、右サイドから攻めるのがベター。",
     holeImg:"https://www.enrei.co.jp/wp-content/uploads/2017/01/rin-map03.jpg"
    },
    {question:"【りんどう4番（難パー3）】特に厳禁とされるミスは？",
     choices:["フック","押し出し・スライス","トップ","ダフリ"],
     answer:1,
     explanation:"距離があり難しい。グリーンは右に傾斜しやすく、押し出しは大きなトラブルに繋がる。",
     holeImg:"https://www.enrei.co.jp/wp-content/uploads/2017/01/rin-map04.jpg"
    },
    {question:"【りんどう5番】正面の突き抜けが起きやすい距離の目安は？",
     choices:["150yd","200yd","250yd","300yd"],
     answer:2,
     explanation:"左ドッグの豪快な打ち下ろし。正面は約250ydで突き抜けるため番手・狙い目の共有が重要。",
     holeImg:"https://www.enrei.co.jp/wp-content/uploads/2017/01/rin-map05.jpg"
    },
    {question:"【りんどう6番（ショート）】狙い目として基本なのは？",
     choices:["グリーンセンター","右奥ピン","左手前","とにかく奥"],
     answer:0,
     explanation:"距離は短めだが外すと寄せが難しくなる。基本はセンター狙い。読み過ぎ注意。",
     holeImg:"https://www.enrei.co.jp/wp-content/uploads/2017/01/rin-map06.jpg"
    },
    {question:"【りんどう7番】ティーショットの狙い目は？",
     choices:["右OB際","左サイド（小屋方向）","右バンカー","ど真ん中"],
     answer:1,
     explanation:"右にOB。狙い目は左サイド（小屋方向）。右傾斜でランが右へ流れやすい点も注意。",
     holeImg:"https://www.enrei.co.jp/wp-content/uploads/2017/01/rin-map07.jpg"
    },
    {question:"【りんどう8番（ロング）】グリーン手前で注意すべき代表的ハザードは？",
     choices:["左のOB","池","左右のバンカー","注意不要"],
     answer:0,
     explanation:"打ち上げでグリーン周りが難しい。左OBが浅いので注意。",
     holeImg:"https://www.enrei.co.jp/wp-content/uploads/2017/01/rin-map08.jpg"
    },
    {question:"【りんどう9番】ティーショットの狙い目は？",
     choices:["左バンカーの右サイド","右OBギリギリ","フェアウェイ右サイド","手前に刻む"],
     answer:0,
     explanation:"谷越えで距離のあるパー4。狙い目は左バンカー右サイド。グリーンは右傾斜のため左手前が安全。",
     holeImg:"https://www.enrei.co.jp/wp-content/uploads/2017/01/rin-map09.jpg"
    },
  ];

  const shionre_suzuran = [
    {question:"【すずらん1番】ティーショットの狙い目（目標物）は？",
     choices:["中央の松","左バンカー","右OB際","池手前"],
     answer:0,
     explanation:"右ドッグレッグ。狙い目は中央の松。グリーンは奥傾斜で手前からがベター。",
     holeImg:"https://www.enrei.co.jp/wp-content/uploads/2017/01/suzu-map01.jpg"
    },
    {question:"【すずらん2番（砲台パー3）】特に注意すべき点は？",
     choices:["右奥","左手前（深い）","グリーン奥","グリーンの傾斜"],
     answer:1,
     explanation:"グリーンの傾斜が強く、奥から早い。",
     holeImg:"https://www.enrei.co.jp/wp-content/uploads/2017/01/suzu-map02.jpg"
    },
    {question:"【すずらん3番】セカンドで番手選びに注意が必要な理由は？",
     choices:["右が谷で左右ともOBが近い","池が正面にある","グリーンが受けて止まり過ぎる","バンカーが無い"],
     answer:0,
     explanation:"2オンも狙えるが、右が谷で左右OBが近い。無理をしない“確率”の案内が重要。",
     holeImg:"https://www.enrei.co.jp/wp-content/uploads/2017/01/suzu-map03.jpg"
    },
    {question:"【すずらん4番】飛距離が出る人のチャレンジとして案内されるルートは？",
     choices:["池越えにチャレンジ","バンカー越え","ワンオン狙い","OB越え"],
     answer:0,
     explanation:"難易度の高いパー4。飛距離に自信がある場合のみ池越えも選択肢。無理強いは禁物。",
     holeImg:"https://www.enrei.co.jp/wp-content/uploads/2017/01/suzu-map04.jpg"
    },
    {question:"【すずらん5番】セカンドで特に警戒すべきのは？",
     choices:["グリーン手前左右の深いバンカー","池","注意不要","クリーク"],
     answer:0,
     explanation:"打ち上げ短いパー4で砲台。グリーン手前左右のバンカーは深く、乗せる距離感が肝。",
     holeImg:"https://www.enrei.co.jp/wp-content/uploads/2017/01/suzu-map05.jpg"
    },
    {question:"【すずらん6番（ショート）】狙い目として基本なのは？",
     choices:["グリーンセンター","右奥","左手前","とにかく奥"],
     answer:0,
     explanation:"打ち下ろし分を考慮して番手選び。オーバーすると寄せが難しくなるのでセンター狙いが基本。",
     holeImg:"https://www.enrei.co.jp/wp-content/uploads/2017/01/suzu-map06.jpg"
    },
    {question:"【すずらん7番】正面が突き抜ける距離の目安は？",
     choices:["280yd","200yd","230yd","250yd"],
     answer:2,
     explanation:"右ドッグ。正面は約230ydで突き抜ける。方向性だけでなく距離管理も必須。",
     holeImg:"https://www.enrei.co.jp/wp-content/uploads/2017/01/suzu-map07.jpg"
    },
    {question:"【すずらん8番】セカンドで注意すべきこととして挙げられるのは？",
     choices:["左OBが浅い＆オーバー注意","右に池がある","攻め放題","グリーンは平らで簡単"],
     answer:0,
     explanation:"左OBが浅いホール。さらにオーバーもトラブルになりやすいので番手選び・狙い所の共有が重要。",
     holeImg:"https://www.enrei.co.jp/wp-content/uploads/2017/01/suzu-map08.jpg"
    },
    {question:"【すずらん9番】このホールの基本の攻めサイドは？",
     choices:["左サイド","右サイド","ど真ん中","どこでも"],
     answer:1,
     explanation:"右サイドから攻めるのがベター。下りで2オンもあるため打ち込み（前組）の安全確認も徹底。",
     holeImg:"https://www.enrei.co.jp/wp-content/uploads/2017/01/suzu-map09.jpg"
    },
  ];

  // 27問まとめ
  const shionre_all = [].concat(shionre_shirakaba, shionre_rindo, shionre_suzuran);

  // =====================
  function showMenu(){
    const savedName = (localStorage.getItem(LS_NAME) || "").trim();
    let html = "<h1>⛳ キャディー研修用クイズ</h1>";
    html += "<div class='center'>";
    if(savedName){
      html += "<span class='pill'>ようこそ： " + escapeHtml(savedName) + " さん</span>";
      html += "<button onclick='selectLevelFromMenu()'>▶ レベル選択へ</button>";
      html += "<button class='btnGhost' onclick='nameInput()'>✏️ 名前を変更して開始</button>";
    }else{
      html += "<button onclick='nameInput()'>▶ ゲーム開始</button>";
    }
    html += "<button class='btnSecondary' onclick='showAdminLogin()'>🔒 管理者</button>";
    html += "</div>";
    document.getElementById("gameArea").innerHTML = html;
  }

  function selectLevelFromMenu(){
    const savedName = (localStorage.getItem(LS_NAME) || "").trim();
    if(!savedName){
      nameInput();
      return;
    }
    playerName = savedName;
    selectLevel();
  }

  // =====================
  function nameInput(){
    let html = "<h2>名前を入力</h2>";
    html += "<input id='nameBox' placeholder='例：山田太郎' style='padding:12px;width:90%;font-size:18px;'><br><br>";
    html += "<button onclick='selectLevel()'>次へ</button>";
    html += "<button class='btnSecondary' onclick='showMenu()'>戻る</button>";
    document.getElementById("gameArea").innerHTML = html;

    setTimeout(() => {
      const el = document.getElementById("nameBox");
      if(el) el.focus();
    }, 0);
  }

  function selectLevel(){
    const el = document.getElementById("nameBox");
    const fromInput = el ? (el.value || "").trim() : "";
    if(fromInput){
      playerName = fromInput;
      localStorage.setItem(LS_NAME, playerName);
    }else{
      const saved = (localStorage.getItem(LS_NAME) || "").trim();
      if(saved) playerName = saved;
    }

    if(!playerName){
      alert("名前を入力してください");
      return;
    }

    let html = "<h2>レベル選択</h2>";
    html += "<div class='center'><span class='pill'>" + escapeHtml(playerName) + " さん</span></div>";

    html += "<button onclick='startLevel(\"beginner\")'>初級</button>";
    html += "<button onclick='startLevel(\"intermediate\")'>中級</button>";
    html += "<button onclick='startLevel(\"advanced\")'>上級</button>";
    if(progress.beginner && progress.intermediate && progress.advanced){
      html += "<button onclick='startLevel(\"master\")'>🔥 超上級</button>";
    }

    /* ===== 塩嶺CC専用モード（追加） ===== */
    html += "<button onclick='showShionreMenu()'>🏞 塩嶺CC 専用モード</button>";

    html += "<button class='btnGhost' onclick='nameInput()'>名前変更</button>";
    html += "<button class='btnSecondary' onclick='showMenu()'>メニューへ</button>";
    document.getElementById("gameArea").innerHTML = html;
  }

  // =====================
  function startLevel(level){
    currentLevel = level;
    currentQuestion = 0;
    score = 0;

    if(level==="beginner") quizData = beginner;
    if(level==="intermediate") quizData = intermediate;
    if(level==="advanced") quizData = advanced;
    if(level==="master") quizData = master;
    if(level==="shionre") quizData = shionre_all;

    loadQuestion();
  }

  // =====================
  // ===== 塩嶺CC専用モードのコース選択（追加） =====
  // =====================
  function showShionreMenu(){
    currentLevel = "shionre";
    let html = "<h2>🏞 塩嶺CC 専用モード</h2>";
    html += "<div class='center'><span class='pill'>" + escapeHtml(playerName) + " さん</span></div>";
    html += "<button onclick='startShionreCourse(\"shirakaba\")'>🌲 しらかば（9問）</button>";
    html += "<button onclick='startShionreCourse(\"rindo\")'>🌸 りんどう（9問）</button>";
    html += "<button onclick='startShionreCourse(\"suzuran\")'>🌼 すずらん（9問）</button>";
    html += "<button onclick='startShionreCourse(\"all\")'>🏁 3コースまとめて（27問）</button>";
    html += "<button class='btnSecondary' onclick='selectLevel()'>レベル選択へ戻る</button>";
    document.getElementById("gameArea").innerHTML = html;
  }

  function startShionreCourse(which){
    currentLevel = "shionre";
    currentQuestion = 0;
    score = 0;

    if(which==="shirakaba") quizData = shionre_shirakaba;
    if(which==="rindo") quizData = shionre_rindo;
    if(which==="suzuran") quizData = shionre_suzuran;
    if(which==="all") quizData = shionre_all;

    loadQuestion();
  }

  // =====================
  function loadQuestion(){
    let q = quizData[currentQuestion];
    let options = [];
    for(let i=0;i<q.choices.length;i++){
      options.push({text:q.choices[i], correct:i===q.answer, originalIndex:i});
    }
    shuffleArray(options);

    let html = "<div class='center'>";
    html += "<span class='pill'>" + levelLabel(currentLevel) + "</span>";
    html += "<span class='pill'>" + escapeHtml(playerName) + " さん</span>";
    html += "</div>";

    html += "<h2>第"+(currentQuestion+1)+"問 / "+quizData.length+"</h2>";

    /* ===== 塩嶺CCのときはホール画像を表示（追加） ===== */
    if(currentLevel==="shionre" && q.holeImg){
      html += "<div class='holeImgWrap'>";
      html += "<img class='holeImg' src='"+q.holeImg+"' alt='ホール図' loading='lazy'>";
      html += "<div class='smallNote'>※ホール図は塩嶺CC公式サイトのコースガイド画像を参照（研修用）</div>";
      html += "</div>";
    }

    html += "<p>"+escapeHtml(q.question)+"</p>";

    for(let i=0;i<options.length;i++){
      html += "<button class='choice' onclick='checkAnswer("+i+")' id='btn"+i+"'>"+escapeHtml(options[i].text)+"</button>";
    }

    html += "<div id='feedback'></div>";

    // 戻るボタン（塩嶺は専用メニューへ戻す）
    if(currentLevel==="shionre"){
      html += "<button class='btnGhost' onclick='showShionreMenu()'>塩嶺CCメニューへ戻る</button>";
    }else{
      html += "<button class='btnGhost' onclick='selectLevel()'>レベル選択へ戻る</button>";
    }

    document.getElementById("gameArea").innerHTML = html;
    window.currentOptions = options;
  }

  // =====================
  function checkAnswer(index){
    let q = quizData[currentQuestion];
    let buttons = document.querySelectorAll(".choice");
    buttons.forEach((btn,i)=> btn.disabled = true);

    const picked = window.currentOptions[index];
    const isCorrect = !!picked.correct;
    if(isCorrect) score++;

    const pickedBtn = document.getElementById("btn"+index);
    if(pickedBtn){
      pickedBtn.classList.add(isCorrect ? "correct" : "wrong");
    }

    if(!isCorrect){
      buttons.forEach((btn,i)=>{
        if(window.currentOptions[i].correct){
          btn.classList.add("correct","revealCorrect");
        }
      });
    }

    const correctText = q.choices[q.answer];

    let fb = "";
    fb += "<div class='explainBox'>";
    fb += "<div class='explainTitle'>" + (isCorrect ? "⭕ 正解！" : "❌ 不正解") + "</div>";
    if(!isCorrect){
      fb += "<div style='margin-bottom:8px;'>正解：<strong>" + escapeHtml(correctText) + "</strong></div>";
    }
    fb += "<div>" + escapeHtml(q.explanation || "（解説が未設定です）") + "</div>";
    fb += "<button style='margin-top:12px;' onclick='nextQuestion()'>" + ((currentQuestion+1<quizData.length) ? "次の問題へ" : "結果を見る") + "</button>";
    fb += "</div>";

    document.getElementById("feedback").innerHTML = fb;
  }

  // =====================
  function nextQuestion(){
    currentQuestion++;
    if(currentQuestion < quizData.length){
      loadQuestion();
    } else {
      showResult();
    }
  }

  // =====================
  function showResult(){
    let rate = Math.round((score/quizData.length)*100);
    let rank = getRank(rate);

    // 塩嶺は進捗アンロック対象外（通常レベルだけ）
    if(currentLevel!=="shionre"){
      if(rate >= 70){
        progress[currentLevel] = true;
        localStorage.setItem("caddieProgress", JSON.stringify(progress));
      }
    }

    let resultData = {
      name: playerName,
      level: currentLevel,
      score: score,
      total: quizData.length,
      rate: rate,
      rank: rank,
      date: new Date().toLocaleString()
    };

    logs.push(resultData);
    localStorage.setItem("caddieLogs", JSON.stringify(logs));

    sendToGoogle(resultData);

    let html = "<h1>結果</h1>";
    html += "<div class='center'><span class='pill'>" + levelLabel(currentLevel) + "</span></div>";
    html += "<p class='center' style='font-size:18px;'>" + score + " / " + quizData.length + "</p>";
    html += "<h2 class='center'>" + rate + "%</h2>";
    html += "<h2 class='center'>" + rank + "</h2>";

    html += "<div class='explainBox'>";
    html += "<div class='explainTitle'>次のおすすめ</div>";
    html += "<div>・間違えた問題の解説をもう一度読む → 同レベル再挑戦が最短で伸びます。</div>";
    html += "</div>";

    // 塩嶺は塩嶺メニューへ戻す
    if(currentLevel==="shionre"){
      html += "<button onclick='showShionreMenu()'>塩嶺CCメニューへ</button>";
      html += "<button class='btnSecondary' onclick='startLevel(\"shionre\")'>27問まとめをもう一度</button>";
      html += "<button class='btnGhost' onclick='selectLevel()'>レベル選択へ</button>";
    }else{
      html += "<button onclick='selectLevel()'>レベル選択へ</button>";
      html += "<button class='btnSecondary' onclick='startLevel(\""+currentLevel+"\")'>同じレベルをもう一度</button>";
      html += "<button class='btnGhost' onclick='showMenu()'>メニューへ</button>";
    }

    document.getElementById("gameArea").innerHTML = html;
  }

  // =====================
  // Google送信
  // =====================
  function sendToGoogle(data){
    if(GOOGLE_SCRIPT_URL === "ここにGASのURLを貼る") return;
    fetch(GOOGLE_SCRIPT_URL, {
      method:"POST",
      mode:"no-cors",
      headers:{"Content-Type":"application/json"},
      body: JSON.stringify(data)
    });
  }

  // =====================
  // 管理者ページ
  // =====================
  function showAdminLogin(){
    let html="<h2>管理者ログイン</h2>";
    html+="<input type='password' id='adminPass' placeholder='パスワード'><br><br>";
    html+="<button onclick='checkAdmin()'>ログイン</button>";
    html+="<button class='btnSecondary' onclick='showMenu()'>戻る</button>";
    document.getElementById("gameArea").innerHTML=html;
  }

  function checkAdmin(){
    if(document.getElementById("adminPass").value==="tkhr7272"){
      showAdmin();
    }else{
      alert("パスワード違います");
    }
  }

  function showAdmin(){
    let html="<h2>成績一覧</h2>";
    if(!logs.length){
      html += "<p class='center'>まだ記録がありません</p>";
    }else{
      logs.slice().reverse().forEach(log=>{
       html += "<p>"
  + escapeHtml(log.date) + " | "
  + escapeHtml(log.name) + " | "
  + escapeHtml(levelLabel(log.level)) + " | "
  + log.rate + "% | "
  + escapeHtml(log.rank)
  + "</p>";
      });
    }
    html+="<button onclick='showMenu()'>戻る</button>";
    document.getElementById("gameArea").innerHTML=html;
  }

  function escapeHtml(str){
  return String(str).replace(/[&<>"']/g, (m) => ({
    "&":"&amp;",
    "<":"&lt;",
    ">":"&gt;",
    '"':"&quot;",
    "'":"&#039;"
  }[m]));
}

  // =====================
  showMenu();
  </script>
</body>
</html>
